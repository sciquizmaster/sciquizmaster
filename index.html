<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sci Quiz Master</title>
<link rel="icon" type="image/x-icon" href="cropped_circle_image.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
:root{--bg:#f4f7fb;--card:rgba(255,255,255,0.6);--text:#111;--accent:#0072ff;--neon:#25D366;}
body.dark{--bg:#0f172a;--card:rgba(255,255,255,0.08);--text:#fff;--accent:#00c6ff;--neon:#25D366;}
body{margin:0;font-family:Segoe UI, sans-serif;background:var(--bg);color:var(--text);transition:0.3s;position:relative;}
header{display:flex;justify-content:space-between;align-items:center;padding:15px 25px;font-size:22px;font-weight:bold;}
.toggle{cursor:pointer;padding:6px 12px;border-radius:20px;background:var(--accent);color:white;display:flex;align-items:center;justify-content:center;}
.container{max-width:800px;margin:auto;padding:20px;position:relative;}
.card{backdrop-filter:blur(20px);background:var(--card);border-radius:20px;padding:30px;box-shadow:0 10px 40px rgba(0,0,0,0.2);margin-top:20px;position:relative;}
.option{margin:10px 0;padding:10px;background:rgba(0,0,0,0.05);border-radius:10px;cursor:pointer;transition: transform 0.5s, background 0.5s, color 0.5s;}
.option:hover{transform:scale(1.05);background:var(--accent);color:white;}
.start-row{display:flex;flex-direction:column;gap:15px;align-items:center;}
.start-row input,.start-row button{width:100%;max-width:400px;box-sizing:border-box;font-size:18px;padding:15px 20px;border-radius:25px;border:none;text-align:center;transition:0.2s;}
.start-row input:focus{outline:none;box-shadow:0 0 10px var(--accent);}
.start-row button:hover{transform:scale(1.03);opacity:0.9;}
#quizTimer{font-size:20px;font-weight:bold;color:red;text-align:center;margin-top:15px;}
.alert-overlay{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;transition:opacity 0.3s;z-index:9999;}
.alert-overlay.active{opacity:1;pointer-events:auto;}
.alert-box{background:rgba(255,255,255,0.2);backdrop-filter:blur(15px);padding:25px 35px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.3);color:#000;font-weight:bold;font-size:20px;text-align:center;transform:translateY(-20px);transition:0.3s;}
.whatsapp-btn{position: relative;display: inline-block;padding: 15px 30px;font-size: 18px;font-weight: bold;text-decoration: none;color: var(--text);border-radius: 40px;overflow: hidden;transition: 0.3s;background: transparent;border: 2px solid transparent;}
.whatsapp-btn::before{content: "";position: absolute;inset: 0;border-radius: 40px;padding: 2px;background: linear-gradient(90deg, #00ffcc, #0072ff, #ff00cc, #00ffcc);background-size: 300% 300%;animation: borderAnim 4s linear infinite;-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite: xor;mask-composite: exclude;}
.whatsapp-btn:hover{transform: scale(1.05);background: var(--accent);color: white;}
@keyframes borderAnim{0%{background-position: 0% 50%;}50%{background-position: 100% 50%;}100%{background-position: 0% 50%;}}
@keyframes slideIn {0% {opacity:0; transform: translateX(-80px);}100% {opacity:1; transform: translateX(0);}}
.card.slide-in {animation: slideIn 1.5s ease forwards;}
#progressContainer{width:100%;background:rgba(0,0,0,0.1);border-radius:20px;height:20px;margin-top:15px;overflow:hidden;}
#progressBar{height:100%;width:100%;background:var(--accent);transition:width 1s linear, background 0.5s ease;}
@media screen and (max-width:480px){header{font-size:18px;padding:10px 15px;} .start-row input,.start-row button{font-size:16px;padding:12px 15px;} #quizTimer{font-size:16px;} #whatsappBtn{font-size:16px;padding:12px 25px;}}
</style>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<header>Sci Quiz Master
<div class="toggle" onclick="toggleMode()"><i id="modeIcon" class="fa-solid fa-sun"></i></div>
</header>

<div class="container">
  <div id="startBox" class="card">
    <h3 style="text-align:center;margin-bottom:20px;">Enter Details</h3>
    <div id="playedCount" style="text-align:center; margin-bottom:15px;">
      <h3>Players Today: <span id="playedNumber">0</span></h3>
    </div>
    <div class="start-row">
      <input id="school" placeholder="School Name">
      <input id="name" placeholder="Your Name">
      <button onclick="prepareQuiz()">Start Quiz</button>
    </div>
  </div>
  <div id="quizBox" class="card" style="display:none;"></div>
  <div id="resultBox" class="card" style="display:none;"></div>
</div>

<div style="text-align:center; margin-top:25px;">
  <a href="https://whatsapp.com/channel/YOUR_CHANNEL_LINK" target="_blank" class="whatsapp-btn">
    Get More Quiz ðŸ”¥ Join Our WhatsApp Channel
  </a>
</div>

<div id="countdownOverlay" class="alert-overlay"><div class="alert-box" id="countdownBox"></div></div>
<div id="customAlert" class="alert-overlay"><div class="alert-box" id="alertMessage"></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyCTfQQHRjOf361iehJWd6Ao4on8yReT1l4",
  authDomain:"scimasterquiz.firebaseapp.com",
  projectId:"scimasterquiz"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const schoolInput=document.getElementById("school");
const nameInput=document.getElementById("name");
const startBox=document.getElementById("startBox");
const quizBox=document.getElementById("quizBox");
const resultBox=document.getElementById("resultBox");
const countdownOverlay=document.getElementById("countdownOverlay");
const countdownBox=document.getElementById("countdownBox");
const customAlert=document.getElementById("customAlert");
const alertMessage=document.getElementById("alertMessage");

function showAlert(msg){alertMessage.innerText=msg;customAlert.classList.add("active");setTimeout(()=>customAlert.classList.remove("active"),2500);}
function getDeviceId(){let id=localStorage.getItem("deviceId");if(!id){id='dev_'+Math.random().toString(36).substr(2,16);localStorage.setItem("deviceId",id);}return id;}
let questions=[],current=0,score=0,timer,timeLeft=60,currentDeviceId;

// ------------------ Manual Questions ------------------
questions = [

{ q:"à¶…à¶¸à·Šà¶½ à¶½à·à·„ à·ƒà¶¸à¶Ÿ à¶´à·Šâ€à¶»à¶­à·’à¶šà·Šâ€à¶»à·’à¶ºà· à¶šà·’à¶»à·“à¶¸à·šà¶¯à·“ à¶´à·’à¶§à·€à¶± à·€à·à¶ºà·”à·€ à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶”à¶šà·Šà·ƒà·’à¶¢à¶±à·Š","à¶±à¶ºà·’à¶§à·Šâ€à¶»à¶¢à¶±à·Š","à·„à¶ºà·’à¶©à·Šâ€à¶»à¶¢à¶±à·Š","à¶šà·à¶¶à¶±à·Š à¶©à¶ºà·œà¶šà·Šà·ƒà¶ºà·’à¶©à·Š"],
answer:2 },

{ q:"à¶‹à¶¯à·à·ƒà·“à¶± à¶¯à·Šâ€à¶»à·€à·Šâ€à¶ºà¶ºà¶š pH à¶…à¶œà¶º à¶šà·“à¶ºà¶¯?",
options:["0","7","14","5"],
answer:1 },

{ q:"à¶´à·’à·‚à·Šà¶¨à¶º à¶¸à¶­ à¶šà·Šâ€à¶»à·’à¶ºà· à¶šà¶» à¶¸à·à¶½à·Šà¶§à·à·ƒà·Š à¶¶à·€à¶§ à¶´à¶­à·Š à¶šà¶»à¶± à¶šà·™à·… à·€à¶½ à¶…à¶©à¶‚à¶œà·” à¶‘à¶±à·Šà·ƒà¶ºà·’à¶¸à¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶´à·™à¶´à·Šà·ƒà·’à¶±à·Š","à¶§à·Šâ€à¶»à·’à¶´à·Šà·ƒà·’à¶±à·Š","à¶§à¶ºà¶½à·’à¶±à·Š (à¶›à·šà¶§ à¶‡à¶¸à¶ºà·’à¶½à·šà·ƒà·Š)","à¶½à¶ºà·’à¶´à·šà·ƒà·Š"],
answer:2 },

{ q:"à¶¸à·’à¶±à·’à·ƒà·Š à·ƒà·’à¶»à·”à¶»à·š à¶¢à·“à¶»à·Šà¶«à¶º à·€à·– à¶†à·„à·à¶» à¶…à·€à·à·à·‚à¶«à¶º à¶šà¶» à¶œà¶±à·Šà¶±à· à¶´à·Šâ€à¶»à¶°à·à¶± à·ƒà·Šà¶®à·à¶±à¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶†à¶¸à·à·à¶º","à¶¸à·„à·à¶±à·Šà¶­à·Šâ€à¶»à¶º","à¶œà·Šâ€à¶»à·„à¶«à·’à¶º","à¶šà·Šà·‚à·”à¶¯à·Šâ€à¶»à·à¶±à·Šà¶­à·Šâ€à¶»à¶º"],
answer:3 },

{ q:"à·€à·˜à¶šà·Šà¶šà¶ºà¶š à·€à·Šâ€à¶ºà·”à·„à¶¸à¶º à·„à· à¶šà·˜à¶­à·Šâ€à¶ºà¶¸à¶º à¶’à¶šà¶šà¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶±à·’à¶ºà·”à¶»à·à¶±à¶º","à·€à·˜à¶šà·Šà¶šà·à¶«à·”à·€","à¶œà·”à¶ à·Šà¶¡à·’à¶šà·à·€","à·„à·™à¶±à¶½à·“ à¶´à·”à¶©à·”à·€"],
answer:1 },

{ q:"à¶¯à·šà·„ à·ƒà¶¸à¶­à·”à¶½à·’à¶­à¶­à·à·€à¶º à¶´à·€à¶­à·Šà·€à· à¶œà·à¶±à·“à¶¸à¶§ à¶¯à·à¶ºà¶š à·€à¶± à¶¸à·œà·…à¶ºà·š à¶šà·œà¶§à·ƒ à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶¸à·ƒà·Šà¶­à·’à·‚à·Šà¶šà¶º","à¶…à¶±à·”à¶¸à·ƒà·Šà¶­à·’à·‚à·Šà¶šà¶º","à·ƒà·”à·‚à·”à¶¸à·Šà¶±à· à·à·“à¶»à·Šà·‚à¶šà¶º","à·„à¶ºà·’à¶´à·œà¶­à·à¶½à¶¸à·ƒ"],
answer:1 },

{ q:"à·„à¶ºà·’à¶©à·Šâ€à¶»à·œà¶šà·à¶¶à¶± à·€à¶½ à¶…à¶©à¶‚à¶œà·” à¶…à¶±à·’à·€à·à¶»à·Šà¶º à¶¸à·–à¶½à¶¯à·Šâ€à¶»à·€à·Šâ€à¶º à¶¯à·™à¶š à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶šà·à¶¶à¶±à·Š à·ƒà·„ à¶”à¶šà·Šà·ƒà·’à¶¢à¶±à·Š","à¶šà·à¶¶à¶±à·Š à·ƒà·„ à·„à¶ºà·’à¶©à·Šâ€à¶»à¶¢à¶±à·Š","à·„à¶ºà·’à¶©à·Šâ€à¶»à¶¢à¶±à·Š à·ƒà·„ à¶±à¶ºà·’à¶§à·Šâ€à¶»à¶¢à¶±à·Š","à¶±à¶ºà·’à¶§à·Šâ€à¶»à¶¢à¶±à·Š à·ƒà·„ à·ƒà¶½à·Šà·†à¶»à·Š"],
answer:1 },

{ q:"à¶†à¶½à·à¶š à·€à¶»à·Šà¶­à¶±à¶ºà·šà¶¯à·“ à¶¸à·“à·…à¶Ÿ à¶¸à·à¶°à·Šâ€à¶ºà¶º à·€à¶»à·Šà¶­à¶±à·à¶‚à¶šà¶ºà·™à¶±à·Š à·€à·à¶©à·’ à¶±à¶¸à·Š, à·€à¶»à·Šà¶­à·’à¶­ à¶šà·’à¶»à¶«à¶º à¶±à·à¶¸à·™à¶±à·Šà¶±à·š à¶šà·”à¶¸à¶± à¶¯à·™à·ƒà¶§à¶¯?",
options:["à¶…à¶·à·’à¶½à¶¸à·Šà¶·à¶º à¶¯à·™à·ƒà¶§","à¶…à¶·à·’à¶½à¶¸à·Šà¶·à¶ºà·™à¶±à·Š à¶‰à·€à¶­à¶§","à¶¸à·à¶°à·Šâ€à¶ºà¶ºà¶±à·Š à·„à¶¸à·” à·€à¶± à¶´à·˜à·‚à·Šà¶¨à¶º à¶¯à·’à¶œà·š","à¶†à¶´à·ƒà·” à·„à·à¶»à·“ à¶ºà¶ºà·’"],
answer:0 },

{ q:"à¶­à·à¶´à¶º à¶¸à·à¶±à·“à¶¸à·š à¶…à¶±à·Šà¶­à¶»à·Šà¶¢à·à¶­à·’à¶š (SI) à¶’à¶šà¶šà¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à·ƒà·™à¶½à·Šà·ƒà·’à¶ºà·ƒà·Š (Celsius)","à¶šà·™à¶½à·Šà·€à·’à¶±à·Š (Kelvin)","à¶¢à·–à¶½à·Š (Joule)","à¶šà·à¶½à¶»à·’ (Calorie)"],
answer:2 },

{ q:"n-à·€à¶»à·Šà¶œà¶ºà·š à¶…à¶»à·Šà¶° à·ƒà¶±à·Šà¶±à·à¶ºà¶šà¶ºà¶š à¶¶à·„à·”à¶­à¶» à·€à·à·„à¶šà¶ºà¶±à·Š à·€à¶±à·Šà¶±à·š à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶šà·”à·„à¶»","à¶´à·Šâ€à¶»à·à¶§à·à¶±","à¶±à·’à¶¯à·„à·ƒà·Š à¶‰à¶½à·™à¶šà·Šà¶§à·Šâ€à¶»à·à¶±","à¶±à·’à¶ºà·”à¶§à·Šâ€à¶»à·à¶±"],
answer:2 },

{ q:"à¶´à¶»à·’à¶«à·à¶¸à¶šà¶ºà¶š à¶´à·Šâ€à¶»à·à¶®à¶¸à·’à¶š à¶¯à¶Ÿà¶»à¶ºà·š à·€à¶§ 500 à¶šà·Š à·ƒà·„ à¶¯à·Šà·€à·’à¶­à·“à¶ºà·’à¶š à¶¯à¶Ÿà¶»à¶ºà·š à·€à¶§ 5000 à¶šà·Š à·€à·š. à¶´à·Šâ€à¶»à·à¶®à¶¸à·’à¶šà¶ºà¶§ 12V à¶½à¶¶à· à¶¯à·”à¶±à·Š à·€à·’à¶§ à¶¯à·Šà·€à·’à¶­à·“à¶ºà·’à¶š à·€à·à¶½à·Šà¶§à·“à¶ºà¶­à·à·€ à¶šà·“à¶ºà¶¯?",
options:["1.2 V","12 V","120 V","60 V"],
answer:2 },

{ q:"à¶½à·à¶šà·Šà¶§à·’à¶šà·Š à¶…à¶¸à·Šà¶½à¶º à¶±à·’à¶´à¶¯à·€à·™à¶±à·Šà¶±à·š à¶šà·”à¶¸à¶± à¶…à·€à·ƒà·Šà¶®à·à·€à¶šà¶¯à·“à¶¯?",
options:["à·à·à¶š à¶´à·Šâ€à¶»à¶·à·à·ƒà¶‚à·ƒà·Šà¶½à·šà·‚à¶«à¶ºà·šà¶¯à·“","à·ƒà¶­à·”à¶±à·Š à¶­à·”à·… à¶±à·’à¶»à·Šà·€à·à¶ºà·” à·ƒà·Šà·€à·ƒà¶±à¶ºà·šà¶¯à·“","à·€à·à¶ºà·”à¶œà·à¶½à·“à¶º à¶±à¶ºà·’à¶§à·Šâ€à¶»à¶¢à¶±à·Š à¶­à·’à¶» à¶šà·’à¶»à·“à¶¸à·šà¶¯à·“","à¶‡à¶½à·Šà¶šà·œà·„à·œà¶½à·Š à¶´à·à·ƒà·€à·“à¶¸à·šà¶¯à·“"],
answer:1 },

{ q:"à¶­à¶¹ à·ƒà·„ à·ƒà·’à¶±à·Šà¶šà·Š à¶¸à·’à·à·Šâ€à¶» à¶šà¶» à·ƒà·à¶¯à· à¶œà¶±à·Šà¶±à· à¶¸à·’à·à·Šâ€à¶» à¶½à·à·„à¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶½à·à¶šà¶©","à¶´à·’à¶­à·Šà¶­à¶½","à¶¸à¶½ à¶±à·œà¶¶à·à¶³à·™à¶± à·€à·à¶±à·š","à¶¸à·à¶œà·Šà¶±à·“à¶½à·’à¶ºà¶¸à·Š"],
answer:1 },

{ q:"à·€à¶»à·Šà¶«à¶½à·šà¶› à·à·’à¶½à·Šà¶´à¶ºà·š à¶…à¶ à¶½ à¶šà¶½à·à¶´à¶º à¶½à·™à·ƒ à¶šà·Šâ€à¶»à·’à¶ºà· à¶šà¶»à¶±à·Šà¶±à·š à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶¢à¶½à¶º","à¶‡à·ƒà·’à¶§à·à¶±à·Š","à·€à¶»à·Šà¶«à¶½à·šà¶› à¶šà¶©à¶¯à·à·ƒà·’à¶º","à¶¯à·Šâ€à¶»à·à·€à¶š à¶´à·Šâ€à¶»à·€à·à·„à¶º"],
answer:2 },

{ q:"à·€à·’à¶¯à·Šâ€à¶ºà·”à¶­à·Š à¶½à·à·„ à¶†à¶½à·šà¶´à¶±à¶ºà·šà¶¯à·“ à¶†à¶½à·šà¶´ à¶šà·… à¶ºà·”à¶­à·” à¶·à·à¶«à·Šà¶©à¶º à·ƒà¶¸à·Šà¶¶à¶±à·Šà¶° à¶šà·… à¶ºà·”à¶­à·Šà¶­à·š à¶šà·”à¶¸à¶± à¶…à¶œà·Šâ€à¶»à¶ºà¶§à¶¯?",
options:["à¶‡à¶±à·à¶©à¶º (+)","à¶šà·à¶­à·à¶©à¶º (-)","à¶´à·˜à¶®à·’à·€à·’ à¶…à¶œà·Šâ€à¶»à¶º","à¶‹à¶¯à·à·ƒà·“à¶± à¶…à¶œà·Šâ€à¶»à¶º"],
answer:1 },

{ q:"à·„à¶»à·’à¶­à·à¶œà·à¶» à¶†à¶ à¶»à¶«à¶ºà¶§ à¶´à·Šâ€à¶»à¶°à·à¶± à·€à·à¶ºà·™à¶±à·Š à¶¶à¶½à¶´à·à¶± à·€à·à¶ºà·”à·€ à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶”à¶šà·Šà·ƒà·’à¶¢à¶±à·Š","à¶šà·à¶¶à¶±à·Š à¶©à¶ºà·œà¶šà·Šà·ƒà¶ºà·’à¶©à·Š","à¶±à¶ºà·’à¶§à·Šâ€à¶»à¶¢à¶±à·Š","à·„à·“à¶½à·’à¶ºà¶¸à·Š"],
answer:1 },

{ q:"à¶¯à·Šà·€à·“ à¶…à·€à¶­à¶½ à¶šà·à¶ à¶ºà¶šà·Š à¶‰à¶¯à·’à¶»à·’à¶ºà·š à·€à·ƒà·Šà¶­à·”à·€à¶šà·Š à¶­à·à¶¶à·– à·€à·’à¶§ à·ƒà·‘à¶¸ à·€à·’à¶§à¶¸ à¶½à·à¶¶à·™à¶± à¶´à·Šâ€à¶»à¶­à·’à¶¶à·’à¶¸à·Šà¶¶à¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶­à·à¶­à·Šà·€à·’à¶š, à¶‹à¶©à·”à¶šà·”à¶»à·”, à·€à·’à·à·à¶½à·’à¶­","à¶…à¶­à·à¶­à·Šà·€à·’à¶š, à¶ºà¶§à·’à¶šà·”à¶»à·”, à¶šà·”à¶©à·","à¶…à¶­à·à¶­à·Šà·€à·’à¶š, à¶‹à¶©à·”à¶šà·”à¶»à·”, à¶šà·”à¶©à·","à¶­à·à¶­à·Šà·€à·’à¶š, à¶ºà¶§à·’à¶šà·”à¶»à·”, à·ƒà¶¸à·à¶± à¶´à·Šâ€à¶»à¶¸à·à¶«à¶ºà·š"],
answer:2 },

{ q:"à·€à·’à¶¯à·Šâ€à¶ºà·”à¶­à·Š à¶‹à¶´à¶šà¶»à¶«à¶ºà¶š à¶šà·Šà·‚à¶¸à¶­à·à·€à¶º (Power) à¶¸à¶±à·’à¶± à¶’à¶šà¶šà¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à·€à·œà¶§à·Š (W)","à·€à·à¶½à·Šà¶§à·Š (V)","à¶‡à¶¸à·Šà¶´à·’à¶ºà¶»à·Š (A)","à¶•à¶¸à·Š (Î©)"],
answer:0 },

{ q:"à¶´à·œà¶½à·’à¶­à·“à¶±à·Š à·ƒà·‘à¶¯à·“à¶¸ à·ƒà¶³à·„à· à¶ºà·œà¶¯à· à¶œà¶±à·Šà¶±à· à¶’à¶š à¶…à·€à¶ºà·€à·’à¶šà¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶´à·Šâ€à¶»à·œà¶´à·“à¶±à·Š","à¶‘à¶­à·“à¶±à·Š","à·€à¶ºà·’à¶±à¶ºà·’à¶½à·Š à¶šà·Šà¶½à·à¶»à¶ºà·’à¶©à·Š","à·ƒà·Šà¶§à¶ºà·’à¶»à·“à¶±à·Š"],
answer:1 },

{ q:"à·à·à¶š à·ƒà·›à¶½à¶ºà¶š à¶†à·„à·à¶» à¶œà¶¶à¶©à· à¶šà¶»à¶± à¶´à¶§à¶šà¶º à¶šà·”à¶¸à¶šà·Šà¶¯?",
options:["à¶¯à·˜à¶ªà·ƒà·Šà¶­à¶»à¶º","à¶¸à·˜à¶¯à·”à·ƒà·Šà¶­à¶»à¶º","à·à·›à¶½à¶¸à¶º","à·ƒà·Šà¶­à·–à¶½à¶šà·à¶«à·à·ƒà·Šà¶­à¶»à¶º"],
answer:1 }

];

// Shuffle questions
questions.sort(() => Math.random() - 0.5);

// ------------------ Device check ------------------
async function hasPlayedDevice(deviceId){
  const q=query(collection(db,"participants"),where("deviceId","==",deviceId));
  const snap=await getDocs(q);
  return !snap.empty;
}

// ------------------ Prepare Quiz with daily limit ------------------
window.prepareQuiz = async function() {
  const school = schoolInput.value.trim();
  const name = nameInput.value.trim();
  if (!school || !name) { showAlert("à¶šà¶»à·”à¶«à·à¶šà¶» à·ƒà·’à¶ºà¶½à·” fields à¶´à·”à¶»à·€à¶±à·Šà¶±"); return; }

  currentDeviceId = getDeviceId();
  if (await hasPlayedDevice(currentDeviceId)) { showAlert("âŒ Submission Blocked: à¶”à¶¶ quiz à¶‘à¶š à¶¯à·à¶±à¶§à¶¸à¶­à·Š à¶šà·Šâ€à¶»à·“à¶©à· à¶šà¶» à¶‡à¶­!"); return; }

  const snap = await getDocs(collection(db,"participants"));
  const now = new Date();
  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
  const todayEnd = todayStart + 24*60*60*1000;
  let todayCount = 0;
  snap.forEach(doc => { const t = doc.data().timestamp?.toMillis(); if(t>=todayStart && t<todayEnd) todayCount++; });

  if(todayCount>=10000){ showAlert("âŒ Our database has exceeded the daily limit of 10000+!, Try Again Next Day."); return; }

  // Countdown
  let numbers=[3,2,1], idx=0;
  countdownOverlay.classList.add("active");
  countdownBox.innerText=`Quiz is Ready! ${numbers[idx]}`;
  const interval=setInterval(()=>{
    idx++;
    if(idx<numbers.length){ countdownBox.innerText=`Quiz is Ready! ${numbers[idx]}`; }
    else{ clearInterval(interval); countdownOverlay.classList.remove("active"); startQuiz(); }
  },1000);
}

// ------------------ Start Quiz ------------------
window.startQuiz = function(){
  startBox.style.display="none"; quizBox.style.display="block"; current=0; score=0; loadQuestion();
}

function loadQuestion(){
  if(current>=questions.length){ finish(); return; }
  const q=questions[current];
  let html=`<h3>${current+1}. ${q.q}</h3>`;
  q.options.forEach((o,i)=>{ html+=`<div class="option" onclick="selectAns(${i})">${o}</div>`; });
  html += `<div id="progressContainer"><div id="progressBar"></div></div>`;
  quizBox.innerHTML=html; quizBox.classList.add("slide-in");
  setTimeout(()=>quizBox.classList.remove("slide-in"),1000);

  timeLeft=60;
  const progressBar=document.getElementById("progressBar"); progressBar.style.width="100%"; progressBar.style.background="var(--accent)";
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--;
    progressBar.style.width=(timeLeft/60*100)+"%";
    if(timeLeft<=0){ clearInterval(timer); selectAns(-1); }
  },1000);
}

window.selectAns=function(i){
  clearInterval(timer);
  const options=document.querySelectorAll(".option");
  const correct=questions[current].answer;
  const progressBar=document.getElementById("progressBar");

  options.forEach((el,idx)=>{
    el.style.pointerEvents="none";
    if(idx===correct){ el.style.background="green"; el.style.color="white"; progressBar.style.background="green"; if(i===correct) confetti({particleCount:30,spread:60,origin:{y:0.6}});}
    if(idx===i && i!==correct){ el.style.background="red"; el.style.color="white"; el.innerText="âŒ "+el.innerText; progressBar.style.background="red";}
  });

  if(i===correct) score++;
  setTimeout(()=>{ current++; loadQuestion(); },1700);
}

// ---------------- Submit Quiz to Firestore ----------------
async function finish(){
  quizBox.style.display="none"; resultBox.style.display="block";
  const now=new Date();
  const month=now.getMonth()+1;

  await addDoc(collection(db,"participants"),{
    key: nameInput.value+" : "+schoolInput.value,
    score,
    timestamp: serverTimestamp(),
    deviceId: currentDeviceId,
    month: month
  });

  if(score>=questions.length*0.75) confetti({particleCount:150,spread:70,origin:{y:0.6}});

  resultBox.innerHTML=`<h2>Your Score: ${score}</h2><h3 id="returnTimer" style="margin-top:15px;color:red;">Returning to Home in 6s</h3>`;
  updatePlayedCount();

  let waitTime=6; const returnTimer=document.getElementById("returnTimer");
  const countdown=setInterval(()=>{
    waitTime--; if(waitTime>0) returnTimer.innerText=`Returning to Home in ${waitTime}s`; else{ clearInterval(countdown); location.reload(); }
  },1000);
}

async function updatePlayedCount(){
  const playedNumber=document.getElementById("playedNumber");
  const snap=await getDocs(collection(db,"participants"));
  const now=new Date();
  const todayStart=new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
  const todayEnd = todayStart + 24*60*60*1000;
  let count=0;
  snap.forEach(doc=>{ const t=doc.data().timestamp?.toMillis(); if(t>=todayStart && t<todayEnd) count++; });
  playedNumber.innerText=count;
}
updatePlayedCount();

window.toggleMode=function(){document.body.classList.toggle("dark"); const icon=document.getElementById("modeIcon"); if(document.body.classList.contains("dark")) icon.classList.replace("fa-sun","fa-moon"); else icon.classList.replace("fa-moon","fa-sun");}
document.addEventListener('contextmenu',e=>{e.preventDefault();showAlert("Right Click Blocked!");});
document.addEventListener('copy',e=>{e.preventDefault();showAlert("Copy Blocked!");});
document.addEventListener('cut',e=>{e.preventDefault();showAlert("Cut Blocked!");});
document.addEventListener('paste',e=>{e.preventDefault();showAlert("Paste Blocked!");});
</script>

</body>
</html>
